<?php
//Copyright (c) 2016 iFeiwu.com
 class Finder extends Ifeiwu { private $root = "\x64\x61\x74\x61\x2f\x66\x69\x6e\x64\145\162\x2f"; function __construct() { goto DaDGr; UqxZ5: parent::__construct(); goto hn858; DaDGr: if ($this->table) { goto Z1aUB; } goto cAyMQ; cAyMQ: $this->table = "\x66\151\156\x64\145\x72"; goto EIk76; EIk76: Z1aUB: goto UqxZ5; hn858: } protected function postAll($pid, $request_data) { goto bvKno; bvKno: $files = $this->db->select($this->table)->where($request_data["\x77\x68\145\162\x65"])->order($request_data["\x6f\x72\144\145\162"])->all(); goto rrsG_; WEu1z: return array("\x66\151\x6c\145\163" => $files, "\160\x61\x74\150\163" => $paths); goto TIzCw; MgMSF: $paths = $this->db->select($this->table, array("\x69\144", "\x6e\x61\155\145"))->where(array("\151\144", "\x49\116", $level), "\101\116\x44", array("\164\171\x70\x65", "\x3d", "\146\x6f\154\144\145\x72"))->all(); goto Tf83S; Tf83S: YGCst: goto WEu1z; okl1k: $level = $this->db->select($this->table, "\154\x65\x76\145\x6c")->where(array("\151\x64", "\x3d", $pid))->get(0); goto Myjmy; arnME: if (!$pid) { goto YGCst; } goto okl1k; rrsG_: $paths = array(); goto arnME; Myjmy: $level = array_filter(explode("\54", $level)); goto MgMSF; TIzCw: } protected function postAdd($request_data) { goto vgxWY; sfLtd: return $this->error("\xe4\270\212\xe4\274\240\346\x96\207\344\xbb\xb6\40" . $name . "\x20\345\244\xb1\xe8\264\xa5\xef\274\x81"); goto k68cF; XGFR2: $data["\167\x69\144\164\150"] = $imagesize[0]; goto J5Ix4; Ugyzz: if (!$this->db->update($this->table, array("\x6c\145\x76\x65\x6c" => $level), array("\151\144", "\75", $id))->is()) { goto k6kKl; } goto Kxnuc; X922l: Rrhk_: goto hjueb; n_BxH: unlink($filename); goto KlEG4; KlEG4: $this->db->rollBack(); goto rmYLR; U3tqC: $data["\x74\171\160\145"] = $type; goto Zya1T; k0AIW: $filename = $this->_UTF82GBK("\x2e\x2e\57" . $path . $name); goto mqHaU; fhKy_: $imagesize = getimagesize($filename); goto XGFR2; vgxWY: $path = $request_data["\x70\141\164\150"]; goto mnLRs; X_1Zt: $data["\145\x78\164"] = end(explode("\56", $name)); goto Iw0Ts; hjueb: pHNFx: goto k0AIW; tpDe8: return $this->error("\xe5\210\233\xe5\273\xba\xe6\x96\207\xe4\273\xb6\xe5\244\271\345\244\xb1\350\264\245\xef\274\201"); goto X922l; Kxnuc: $this->db->commit(); goto aMPuk; J5Ix4: $data["\x68\x65\x69\x67\150\x74"] = $imagesize[1]; goto aZiUN; fXjVW: $type = mime_content_type("\56\56\x2f" . $path . $name); goto w2fWV; mqHaU: if (!(stripos($type, "\x69\155\141\x67\x65") !== false && is_file($filename))) { goto b57jR; } goto fhKy_; aMPuk: return $this->success(); goto TozXG; E3Tmw: if (mkdir($this->_UTF82GBK("\x2e\x2e\x2f" . $path), 511, true)) { goto Rrhk_; } goto tpDe8; EzRzJ: tDIkM: goto wsKB0; Iw0Ts: $this->db->beginTransaction(); goto fwpfw; LN7bl: $this->db->rollBack(); goto sfLtd; Zya1T: $data["\x70\x69\144"] = $foid ? $foid : 0; goto Ijv86; or4Uz: if (is_dir($this->_UTF82GBK("\x2e\56\x2f" . $path))) { goto pHNFx; } goto E3Tmw; aZiUN: b57jR: goto qP7qi; xqXG9: $data["\156\x61\155\x65"] = $name; goto U3tqC; Ijv86: $data["\x73\x69\172\145"] = $request_data["\x73\x69\x7a\145"]; goto a_Lar; a_Lar: $data["\x63\164\x69\155\x65"] = time(); goto X_1Zt; rmYLR: return $this->error("\xe4\270\x8a\xe4\xbc\240\346\x96\x87\xe4\xbb\xb6\40" . $name . "\40\xe5\244\xb1\350\264\xa5\xef\274\201"); goto EzRzJ; TozXG: k6kKl: goto LN7bl; mnLRs: $name = $request_data["\x6e\x61\x6d\145"]; goto fXjVW; w2fWV: $foid = $request_data["\x66\x6f\x69\144"]; goto or4Uz; wsKB0: $level = $this->_getLevel($id); goto Ugyzz; qP7qi: $data["\x70\x61\164\x68"] = $path; goto xqXG9; fwpfw: if ($id = $this->db->insert($this->table, $data)->id()) { goto tDIkM; } goto n_BxH; k68cF: } protected function postMkdir($request_data) { goto a9TJA; bQrEA: niJK8: goto GVFPL; yKnyu: $name = $request_data["\x6e\141\155\x65"]; goto JbVev; ltbRB: $this->db->rollBack(); goto nu_DU; oYn7l: rmdir($dirname); goto ltbRB; Ux2wt: return $this->error("\xe6\x97\xa0\xe6\x95\x88\xe7\232\x84\xe5\x8f\202\346\225\260\357\xbc\201"); goto ObesZ; CAqNW: $folder = $this->db->select($this->table, "\140\156\141\155\x65\140")->where(array("\151\x64", "\x49\x4e", $level), "\101\116\x44", array("\164\x79\160\145", "\x3d", "\146\157\x6c\144\x65\162"))->all(); goto lwz7l; aVZwS: $dirname = $this->_UTF82GBK("\x2e\x2e\57" . $this->root . $folder_path . $name); goto kXLuZ; WmPGI: if (!$level) { goto XqDqB; } goto jYbFZ; oSUcX: $folder_path = ''; goto XfZLG; rKPLU: if (mkdir($dirname, 493, true)) { goto xrFk3; } goto g8xcD; Tksrs: $this->db->beginTransaction(); goto qdsr0; FlEq8: $data["\x74\x79\160\x65"] = "\146\x6f\154\x64\145\x72"; goto vBDwQ; iEBNX: aMfUz: goto rKPLU; byOcY: $data["\x6e\x61\x6d\x65"] = $name; goto wdNol; GVFPL: XqDqB: goto aVZwS; XfZLG: $level = $this->db->select($this->table, "\x60\154\x65\166\145\154\x60")->where(array("\x69\144", "\x3d", $pid))->get(0); goto WmPGI; UN2s0: return $this->success(); goto pZSif; g8xcD: return $this->error("\xe5\210\233\xe5\xbb\xba\xe6\226\207\xe4\273\266\xe5\xa4\271\345\xa4\261\350\xb4\245\357\xbc\201"); goto H7GeQ; i27Ar: $level = $this->_getLevel($id); goto oFvK_; ObesZ: hJ_iW: goto M5GeI; zeV23: rmdir($dirname); goto kYZma; lwz7l: foreach ($folder as $value) { $folder_path .= $value["\156\141\x6d\145"] . "\x2f"; AExPU: } goto bQrEA; a9TJA: $pid = $request_data["\x70\x69\x64"]; goto yKnyu; jYbFZ: $level = array_filter(explode("\x2c", $level)); goto CAqNW; sq1N6: $data["\x73\x6f\162\x74\142\x79"] = 1; goto FlEq8; pZSif: dCKnl: goto IYwaL; kYZma: $this->db->rollBack(); goto tKARs; jBUUK: if ($id = $this->db->insert($this->table, $data)->id()) { goto lkGn4; } goto zeV23; nu_DU: return $this->error("\345\210\x9b\345\xbb\272\346\x96\207\xe4\273\266\345\244\xb9\345\xa4\261\xe8\264\xa5\xef\xbc\201"); goto kUjjR; snzgg: lkGn4: goto i27Ar; H7GeQ: xrFk3: goto Tksrs; JbVev: if (!($name === null || $name === '')) { goto hJ_iW; } goto Ux2wt; M5GeI: $data = array(); goto byOcY; wpKYm: o81pq: goto xUl2q; xUl2q: $this->db->commit(); goto UN2s0; vBDwQ: $data["\x63\164\x69\155\x65"] = time(); goto jBUUK; tKARs: return $this->error("\345\210\x9b\345\xbb\272\xe6\226\x87\344\273\266\xe5\244\xb9\xe5\244\261\xe8\xb4\xa5\357\274\x81"); goto snzgg; kVUqT: return $this->error($name . "\x20\346\226\207\xe4\xbb\266\xe5\xa4\271\345\xb7\262\xe5\xad\x98\345\234\xa8\357\274\x81"); goto iEBNX; kUjjR: goto dCKnl; goto wpKYm; oFvK_: if ($this->db->update($this->table, array("\x6c\x65\x76\x65\154" => $level), array("\x69\x64", "\x3d", $id))->is()) { goto o81pq; } goto oYn7l; wdNol: $data["\160\151\x64"] = $pid; goto oSUcX; qdsr0: $data["\160\x61\164\x68"] = $this->root . $folder_path; goto sq1N6; kXLuZ: if (!is_dir($dirname)) { goto aMfUz; } goto kVUqT; IYwaL: } protected function postRename($request_data) { goto jE4U9; o5CTQ: if (rename($oldname, $newname)) { goto drb9z; } goto hCG08; xQTL7: OxJnj: goto QJdD_; PpiHW: if ($this->db->update($this->table, array("\x6e\x61\155\145" => $name), array("\151\x64", "\x3d", $id))->is()) { goto cHDzA; } goto Tarsg; yN5X2: $name = $request_data["\x6e\x61\x6d\x65"]; goto kUJCv; t8yse: $this->db->commit(); goto BfGen; hRWnu: YDykN: goto pPBrG; fJ7sx: bfNG5: goto t8yse; T6slS: $oldname = $this->_UTF82GBK("\x2e\56\57" . $path . $finder["\156\x61\155\145"]); goto RY7Jp; jE4U9: $id = $request_data["\x69\x64"]; goto yN5X2; tn61P: RFapt: goto QGIq7; cNpVc: goto vicZv; goto jwXrs; nHbee: goto C1dEM; goto fJ7sx; YuH3m: return $this->error("\346\x96\207\344\273\xb6\345\xa4\xb9\351\207\215\xe5\x91\xbd\345\x90\x8d\xe5\xa4\261\350\264\xa5\xef\274\x81"); goto cNpVc; turuh: gIiPn: goto zGl42; Wo92o: return $this->error("\xe6\226\207\344\273\xb6\xe9\x87\215\345\221\xbd\345\x90\215\345\xa4\261\350\xb4\245\xef\xbc\201"); goto nHbee; zGl42: if (rename($oldname, $newname)) { goto bfNG5; } goto iCJ2r; GOx08: if (is_file($oldname)) { goto Yj6le; } goto A_zeK; P3ffQ: return $this->error($name . "\x20\346\x96\207\xe4\273\266\xe5\244\xb9\345\267\xb2\345\xad\230\xe5\234\xa8\xef\274\201"); goto ujmBf; bBS_f: drb9z: goto eT0Kl; BShrX: return $this->success(); goto hRWnu; pLcjs: Ewjkj: goto T6slS; QJdD_: goto S2X4p; goto Nz3eB; RY7Jp: $newname = $this->_UTF82GBK("\56\x2e\x2f" . $path . $name); goto I8Jao; QGIq7: $this->db->commit(); goto BShrX; uFPH4: $finder = $this->db->select($this->table, array("\x70\141\164\x68", "\156\141\x6d\x65", "\x6c\x65\166\x65\x6c"))->where(array("\151\x64", "\x3d", $id))->get(); goto dRB8a; DLo5d: return $this->error("\xe6\x96\x87\344\273\xb6\xe9\x87\x8d\xe5\x91\275\xe5\x90\x8d\xe5\244\xb1\xe8\264\245\357\xbc\201"); goto KbvfL; hCG08: $this->db->rollBack(); goto P3ffQ; Mo9LY: return $this->error("\346\x96\207\xe4\273\xb6\xe5\244\xb9\xe9\x87\215\xe5\x91\275\xe5\220\215\xe5\244\261\350\264\xa5\357\xbc\201"); goto WFCO3; oDKua: if (!(!$path || stripos($path, $this->root) === false)) { goto Ewjkj; } goto mJc3O; kUJCv: if (!(!$id || $name === null || $name === '')) { goto tH43H; } goto ngkt4; Nz3eB: LSPMk: goto PpiHW; dRB8a: $path = $finder["\x70\x61\x74\150"]; goto oDKua; ujmBf: goto Po8jK; goto bBS_f; mJc3O: return $this->error("\xe6\227\240\xe6\x95\210\xe7\x9a\x84\xe8\267\257\xe5\276\204\357\274\201"); goto pLcjs; I8Jao: $this->db->beginTransaction(); goto GOx08; DSush: if ($is_path_update !== false) { goto RFapt; } goto j4Kv6; IPoMs: mqww1: goto DSush; ci3oB: Yj6le: goto kvKnw; NX39U: tH43H: goto uFPH4; eT0Kl: $sublist = $this->db->select($this->table, array("\151\x64", "\x6c\x65\166\x65\154", "\x74\171\160\145"))->where(array("\x6c\x65\x76\x65\x6c", "\x4c\111\x4b\x45", "\x25\x2c{$id}\54\45"))->all(); goto iSLfw; iSLfw: foreach ($sublist as $sub) { goto hcD3X; xCfnu: VdIl1: goto DpvSE; eeb_U: if (!($is_path_update === false)) { goto VdIl1; } goto cIeOo; jSPhQ: foreach ($level as $lid) { goto MgrZV; bF0o0: if (!($sub["\x74\x79\x70\x65"] == "\x66\157\154\x64\145\162" && $sub["\154\x65\x76\x65\154"] == $levelobj["\154\145\166\145\154"])) { goto Fx3zz; } goto XT_ev; GuK20: $level_name = $levelobj["\x6e\x61\155\145"]; goto oGi68; WNTb9: dbRA9: goto YJq9n; MgrZV: $levelobj = $this->db->select($this->table, array("\156\141\x6d\145", "\154\x65\x76\x65\154"))->where("\151\x64\x20\75\40{$lid}\x20\101\x4e\104\x20\x74\171\160\145\40\75\x20\47\146\157\154\144\x65\162\47")->get(); goto bF0o0; oGi68: $newpath .= $level_name != '' ? $level_name . "\57" : ''; goto WNTb9; XT_ev: goto dbRA9; goto KrNvN; KrNvN: Fx3zz: goto GuK20; YJq9n: } goto zB124; nMr19: $level = array_filter(explode("\54", $sub["\154\x65\x76\145\154"])); goto jSPhQ; DpvSE: wpNfE: goto T7iFF; tLuhm: $newpath = ''; goto nMr19; zB124: V2pA2: goto rWcrX; cIeOo: goto mqww1; goto xCfnu; Kl0Ly: OtAvq: goto tLuhm; hcD3X: if (!($sub["\x6c\x65\x76\x65\x6c"] == $finder["\x6c\x65\x76\145\154"])) { goto OtAvq; } goto p5FEp; p5FEp: goto wpNfE; goto Kl0Ly; rWcrX: $is_path_update = $this->db->update($this->table, array("\x70\141\x74\150" => $this->root . $newpath), array("\151\x64", "\75", $sub["\x69\x64"]))->is(); goto eeb_U; T7iFF: } goto IPoMs; KbvfL: goto OxJnj; goto turuh; hSE2R: return $this->error("\xe6\x89\xbe\xe4\270\215\345\x88\260\351\x87\x8d\xe5\221\275\345\220\x8d\xe7\x9a\x84\346\x96\207\344\273\266\x2f\346\x96\207\344\273\xb6\345\244\271\357\xbc\x81"); goto eJiP5; kvKnw: if ($this->db->update($this->table, array("\156\141\155\x65" => $name), array("\151\144", "\75", $id))->is()) { goto gIiPn; } goto H90UH; ngkt4: return $this->error("\xe6\227\xa0\346\x95\210\347\232\204\xe5\x8f\x82\346\x95\xb0\xef\274\x81"); goto NX39U; Tarsg: $this->db->rollBack(); goto YuH3m; AJ5EV: $this->db->rollBack(); goto Mo9LY; eJiP5: goto S2X4p; goto ci3oB; H90UH: $this->db->rollBack(); goto DLo5d; WFCO3: goto YDykN; goto tn61P; j4Kv6: rename($newname, $oldname); goto AJ5EV; A_zeK: if (is_dir($oldname)) { goto LSPMk; } goto hSE2R; yRlzb: S2X4p: goto N7T2P; jwXrs: cHDzA: goto o5CTQ; tuMTm: C1dEM: goto xQTL7; pPBrG: Po8jK: goto kiK74; kiK74: vicZv: goto yRlzb; BfGen: return $this->success(); goto tuMTm; iCJ2r: $this->db->rollBack(); goto Wo92o; N7T2P: } protected function postIsFile($request_data) { goto cI31d; Kd4W9: $name = $request_data["\x6e\x61\155\x65"]; goto TQiTm; TQiTm: if (file_exists($this->_UTF82GBK("\56\56\x2f" . $path . $name))) { goto n3Jh9; } goto C42Ff; V_mq4: goto p3lEt; goto JSiHS; cI31d: $path = $request_data["\x70\x61\164\x68"]; goto Kd4W9; C42Ff: return $this->error($name . "\x20\xe6\226\x87\xe4\xbb\xb6\344\xb8\x8d\345\xad\230\xe5\234\xa8\xef\xbc\201"); goto V_mq4; WwZxv: p3lEt: goto v0iac; JSiHS: n3Jh9: goto sjKEU; sjKEU: return $this->success($name . "\x20\346\226\207\344\xbb\266\xe5\267\xb2\xe5\255\230\345\x9c\xa8\357\274\201"); goto WwZxv; v0iac: } protected function postDelete($request_data) { goto qixUl; C_Nw7: foreach ($ids as $id) { goto C7P11; jdEFI: $this->db->delete($this->table, array("\x69\144", "\75", $id))->is(); goto vqfQs; BBjKj: goto OwX_G; goto NECJf; JqwjU: if (is_file($filename)) { goto VZdDM; } goto BNme9; jPIjG: QI037: goto FoROG; NJ9w8: $path = $file["\x70\x61\164\150"]; goto ZCtxy; ZCtxy: $name = $file["\156\141\x6d\145"]; goto QkhaJ; bLKc0: $this->db->delete($this->table, array("\x6c\x65\166\x65\x6c", "\114\111\113\x45", "\45\x2c{$id}\x2c\45")); goto c5JxQ; mF7MV: if ($file) { goto Z16sE; } goto BBjKj; FoROG: $filename = $this->_UTF82GBK("\x2e\56\x2f" . $path . $name); goto JqwjU; BNme9: if (is_dir($filename)) { goto EmM6U; } goto bLKc0; BgNJd: @unlink($filename); goto S8wdp; C7P11: $file = $this->db->select($this->table, array("\160\x61\164\150", "\156\x61\155\x65"))->where(array("\151\x64", "\x3d", $id))->get(); goto mF7MV; NECJf: Z16sE: goto NJ9w8; QkhaJ: if (!(!$path || stripos($path, "\144\141\x74\141\x2f\x66\x69\156\x64\x65\x72\57") === false || $name == null || $name == '')) { goto QI037; } goto jdEFI; dS41x: wzYD3: goto QhnLQ; JDnsG: if (!$this->db->delete($this->table, array("\151\144", "\75", $id))->is()) { goto f6wHB; } goto BgNJd; VZ_DJ: VZdDM: goto JDnsG; N2SLp: $this->_rmdir($filename); goto K0MPK; vqfQs: goto OwX_G; goto jPIjG; c5JxQ: goto wzYD3; goto VZ_DJ; S8wdp: f6wHB: goto vCFnj; K0MPK: ZirV3: goto dS41x; nq_zP: EmM6U: goto FUiY7; vCFnj: goto wzYD3; goto nq_zP; FUiY7: if (!$this->db->delete($this->table, array("\154\x65\166\145\154", "\x4c\x49\x4b\x45", "\45\54{$id}\54\45"))->is()) { goto ZirV3; } goto N2SLp; QhnLQ: OwX_G: goto P9m_n; P9m_n: } goto epiYg; epiYg: WsIZG: goto UFggx; qixUl: $ids = $request_data["\x69\144"]; goto C_Nw7; UFggx: return $this->success(); goto kK8kr; kK8kr: } protected function getCurPath($foid) { goto Gwu8E; Gwu8E: $level = $this->db->select($this->table, "\x6c\145\166\x65\154")->where(array("\151\x64", "\75", $foid))->get(0); goto H1_K1; uIS5A: return $this->success('', $data); goto HznNZ; H1_K1: $level = array_filter(explode("\54", $level)); goto YIfzU; YIfzU: $data = $this->db->select($this->table, array("\x69\x64", "\156\x61\x6d\145"))->where(array(array("\x69\144", "\111\116", $level), "\101\x4e\x44", array("\164\x79\x70\x65", "\x3d", "\146\x6f\154\144\145\162")))->all(); goto uIS5A; HznNZ: } }
